<!DOCTYPE html>
<html lang="pt-br">
<!-- ok -->

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>INSCRIÃ‡Ã•ES</title>
    <link rel="shortcut icon" href="./assets/3.ico" type="image/x-icon">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&display=swap">
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>
    <script src="./firebase/firebaseConfig.js"></script>
    <style>
        body {
            background-color: #f4ebda;
            padding-top: 0px;
            overflow: hidden;
            text-align: center;
            position: relative;
        }

        .position-relative {
            position: relative;
        }

        .btn-hidden {
            display: none !important;
        }

        .btn-gradient {
            background: linear-gradient(to right, #7a2c6c, #a92f85);
            color: white;
            font-weight: bold;
            padding: 12px 30px;
            border-radius: 50px;
            font-size: 18px;
            text-transform: uppercase;
            border: none;
            box-shadow: 0 4px 15px rgba(58, 16, 86, 0.4);
            transition: all 0.3s ease;
            position: absolute;
            top: 52%;
            left: 84%;
            transform: translateX(-50%);
            text-decoration: none;
            min-width: 200px;
            text-align: center;
            animation: subtle-glow 3s ease-in-out infinite;
        }

        .btn-gradient:hover {
            background: linear-gradient(to right, #a92f85, #7a2c6c);
            transform: translateX(-50%) translateY(-2px);
            box-shadow: 0 8px 25px rgba(58, 16, 86, 0.6);
            color: white;
            text-decoration: none;
            animation: none;
        }

        .btn-esgotado {
            background: #6c757d !important;
            color: white !important;
            cursor: not-allowed !important;
            box-shadow: none !important;
            animation: none !important;
        }

        .btn-esgotado:hover {
            background: #6c757d !important;
            transform: translateX(-50%) !important;
            box-shadow: none !important;
            color: white !important;
            text-decoration: none !important;
        }

        .alerta-esgotado {
            position: absolute;
            top: 49%;
            left: 50%;
            transform: translateX(-50%);
            background-color: #f8d7da;
            border: 2px solid #f5c6cb;
            color: #721c24;
            padding: 15px 25px;
            border-radius: 10px;
            text-align: center;
            font-weight: bold;
            font-size: 16px;
            max-width: 400px;
            z-index: 15;
            animation: fadeIn 0.5s ease-in-out;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateX(-50%) translateY(-10px);
            }

            to {
                opacity: 1;
                transform: translateX(-50%) translateY(0);
            }
        }

        /* Efeito glow profissional */
        @keyframes subtle-glow {

            0%,
            100% {
                box-shadow: 0 4px 15px rgba(58, 16, 86, 0.4);
            }

            50% {
                box-shadow: 0 4px 20px rgba(169, 47, 132, 0.6), 0 0 30px rgba(122, 44, 108, 0.3);
            }
        }

        .desktop-image {
            margin-top: 0px;
            width: 100%;
            height: auto;
            display: block;
            margin-left: auto;
            margin-right: auto;
            object-fit: contain;
        }

        .mobile-image {
            display: none;
        }

        .loading-spinner {
            position: absolute;
            top: 55%;
            left: 53%;
            transform: translate(-50%, -50%);
            z-index: 10;
        }

        .spinner {
            width: 50px;
            height: 50px;
            border: 4px solid #f3f3f3;
            border-top: 4px solid #a92f85;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        .loading-text {
            margin-top: 15px;
            color: #ffffff;
            font-weight: bold;
            font-size: 16px;
            text-align: center;
            width: 100%;
            display: block;
            margin-left: -35%;
            margin-right: auto;
        }

        @keyframes spin {
            0% {
                transform: rotate(0deg);
            }

            100% {
                transform: rotate(360deg);
            }
        }

        .gestao-icon {
            position: fixed;
            top: 7px;
            right: 7px;
            z-index: 1000;
            color: rgb(0, 0, 0) !important;
            font-size: 20px;
            text-decoration: none;
            opacity: 0.6;
            transition: opacity 0.2s ease;
            filter: none;
            text-shadow: none;
            background: none;
            border: none;
            box-shadow: none;
        }

        .gestao-icon:hover {
            opacity: 1;
            color: rgb(0, 0, 0) !important;
            text-decoration: none;
            transform: none;
            filter: none;
            text-shadow: none;
            background: none;
            border: none;
            box-shadow: none;
        }

        @media screen and (max-width: 852px) {
            body {
                height: 100vh;
                overflow: hidden;
            }

            .mobile-image {
                display: block;
                position: fixed;
                top: 0;
                left: 0;
                width: 100vw;
                height:100%;
                object-fit: cover;
                z-index: 1;
                margin: 0;
                padding: 0;
            }

            .desktop-image {
                display: none;
            }

            .btn-gradient {
                padding: 4% 4%;
                font-size: 5%x;
                min-width: 75%;
                top: 69.5%;
                left: 50%;
                z-index: 10;
                position: fixed;
            }

            .alerta-esgotado {
                position: fixed;
                top: 80%;
                left: 53%;
                max-width: 90%;
                font-size: 20px;
                padding: 12px 20px;
            }

            .loading-spinner {
                position: fixed;
                top: 76%;
                min-width: 60%;
                left: 75%;
                z-index: 10;
            }

            .loading-text {
                margin-top: 5px;
                margin-left: -40%;
            }
        }

        @media screen and (min-width: 853px) and (max-width: 1024px) {
            .mobile-image {
                display: block;
                position: fixed;
                top: 0;
                left: 0;
                width: 100vw;
                height:100%;
                object-fit: cover;
                z-index: 1;
                margin: 0;
                padding: 0;
            }

            .desktop-image {
                display: none;
            }

            .btn-gradient {
                padding: 6% 4%;
                font-size: 5%x;
                min-width: 80%;
                top: 70%;
                left: 50%;
                z-index: 10;
                position: fixed;
            }

            .alerta-esgotado {
                position: fixed;
                top: 70%;
                left: 53%;
                max-width: 90%;
                font-size: 20px;
                padding: 12px 20px;
            }

            .loading-spinner {
                position: fixed;
                top: 75%;
                min-width: 60%;
                left: 75%;
                z-index: 10;
            }

            .loading-text {
                margin-top: 5px;
                margin-left: -40%;
            }
        }
    </style>
</head>

<body>
    <!-- Ãcone de GestÃ£o -->
    <a href="login.html" class="gestao-icon" title="Acessar GestÃ£o">
        <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" fill="black" class="bi bi-gear" viewBox="0 0 16 16">
            <path d="M8 4.754a3.246 3.246 0 1 0 0 6.492 3.246 3.246 0 0 0 0-6.492M5.754 8a2.246 2.246 0 1 1 4.492 0 2.246 2.246 0 0 1-4.492 0"/>
            <path d="M9.796 1.343c-.527-1.79-3.065-1.79-3.592 0l-.094.319a.873.873 0 0 1-1.255.52l-.292-.16c-1.64-.892-3.433.902-2.54 2.541l.159.292a.873.873 0 0 1-.52 1.255l-.319.094c-1.79.527-1.79 3.065 0 3.592l.319.094a.873.873 0 0 1 .52 1.255l-.16.292c-.892 1.64.901 3.434 2.541 2.54l.292-.159a.873.873 0 0 1 1.255.52l.094.319c.527 1.79 3.065 1.79 3.592 0l.094-.319a.873.873 0 0 1 1.255-.52l.292.16c1.64.892 3.434-.902 2.54-2.541l-.159-.292a.873.873 0 0 1 .52-1.255l.319-.094c1.79-.527 1.79-3.065 0-3.592l-.319-.094a.873.873 0 0 1-.52-1.255l.16-.292c.892-1.64-.902-3.433-2.541-2.54l-.292.159a.873.873 0 0 1-1.255-.52zm-2.633.283c.246-.835 1.428-.835 1.674 0l.094.319a1.873 1.873 0 0 0 2.693 1.115l.291-.16c.764-.415 1.6.42 1.184 1.185l-.159.292a1.873 1.873 0 0 0 1.116 2.692l.318.094c.835.246.835 1.428 0 1.674l-.319.094a1.873 1.873 0 0 0-1.115 2.693l.16.291c.415.764-.42 1.6-1.185 1.184l-.291-.159a1.873 1.873 0 0 0-2.693 1.116l-.094.318c-.246.835-1.428.835-1.674 0l-.094-.319a1.873 1.873 0 0 0-2.692-1.115l-.292.16c-.764.415-1.6-.42-1.184-1.185l.159-.291A1.873 1.873 0 0 0 1.945 8.93l-.319-.094c-.835-.246-.835-1.428 0-1.674l.319-.094A1.873 1.873 0 0 0 3.06 4.377l-.16-.292c-.415-.764.42-1.6 1.185-1.184l.292.159a1.873 1.873 0 0 0 2.692-1.115z"/>
        </svg>
    </a>

    <img src="./assets/Texto.png" alt="Texto" class="img-fluid mb-4 desktop-image">
    <img src="./assets/Texto Celular.png" alt="Texto" class="img-fluid mb-4 mobile-image">

    <a href="frminscricao.html" class="btn-gradient btn-hidden" id="btnInscricao">
        Inscreva-se Agora
    </a>

    <div class="loading-spinner" id="loadingSpinner">
        <div class="spinner"></div>
        <div class="loading-text">Verificando vagas disponÃ­veis...</div>
    </div>

    <div class="alerta-esgotado" id="alertaEsgotado" style="display: none;">
        <div>ðŸš« <strong>InscriÃ§Ãµes Encerradas!</strong></div>
        <div style="font-size: 14px; margin-top: 5px;">Limite de vagas atingido</div>
    </div>

    <script>
        // âœ… SOLUÃ‡ÃƒO: Ler apenas 1 documento contador
        function verificarLimiteInscricoes() {
            if (typeof db === 'undefined') {
                console.error('Firebase nÃ£o foi inicializado corretamente');
                return;
            }

            const loadingSpinner = document.getElementById('loadingSpinner');
            loadingSpinner.style.display = 'block';

            // âœ… LER APENAS 1 DOCUMENTO = 1 LEITURA
            db.collection("Eventos").doc("TreinamentoMI2026")  // Acesse diretamente o documento TreinamentoMI2026
                .get()  // Aqui vocÃª jÃ¡ faz a leitura do documento
                .then((doc) => {
                    if (doc.exists) {
                        const data = doc.data();
                        const totalInscricoes = (data.contador && data.contador.totalInscricoes) ? data.contador.totalInscricoes : 0;  // VerificaÃ§Ã£o segura do contador
                        console.log(`Total de inscriÃ§Ãµes Filhas do Rei: ${totalInscricoes}`);

                        const btnInscricao = document.getElementById('btnInscricao');
                        const alertaEsgotado = document.getElementById('alertaEsgotado');

                        loadingSpinner.style.display = 'none';
                        btnInscricao.classList.remove('btn-hidden');

                        if (totalInscricoes >= 800) {
                            // Desabilitar o botÃ£o
                            btnInscricao.classList.add('btn-esgotado');
                            btnInscricao.classList.remove('btn-gradient');
                            btnInscricao.textContent = 'InscriÃ§Ãµes Encerradas';
                            btnInscricao.href = '#';
                            btnInscricao.onclick = function (e) {
                                e.preventDefault();
                                alert('Desculpe, as inscriÃ§Ãµes foram encerradas. Limite de vagas atingido.');
                                return false;
                            };
                            alertaEsgotado.style.display = 'block';
                        } else {
                            // Manter o botÃ£o habilitado
                            btnInscricao.classList.remove('btn-esgotado');
                            btnInscricao.classList.add('btn-gradient');
                            btnInscricao.textContent = 'Inscreva-se Agora';
                            btnInscricao.href = 'frminscricao.html';
                            btnInscricao.onclick = null;
                            alertaEsgotado.style.display = 'none';
                        }
                    } else {
                        console.log("Documento TreinamentoMI2026 nÃ£o existe");
                        // Fallback: assumir 0 inscriÃ§Ãµes
                        handleButtonState(0);
                    }
                })
                .catch((error) => {
                    console.error("Erro ao verificar contador:", error);
                    // Em caso de erro, mostrar o botÃ£o funcionando
                    handleErrorState();
                });


        }

        // Verificar limite quando a pÃ¡gina carregar
        document.addEventListener('DOMContentLoaded', function () {
            // Aguardar um pouco para garantir que o Firebase foi inicializado
            setTimeout(verificarLimiteInscricoes, 1000);
        });

        // Verificar limite periodicamente (a cada 30 segundos)
        setInterval(verificarLimiteInscricoes, 30000);
    </script>
</body>

</html>